{
    "rules": {
        "freewrite_sessions": {
            "$sessionId": {
                ".read": "auth != null",
                ".write": "auth != null"
            }
        },
        "pro_gate": {
            ".read": "auth != null",
            ".write": "auth.token.email === 'ukiyo@rekindle.ink'"
        },
        "kindlechat": {
            "messages": {
                ".read": true,
                ".write": "auth.token.email === 'ukiyo@rekindle.ink'",
                ".indexOn": [
                    "timestamp",
                    "user"
                ],
                "$messageId": {
                    ".write": "auth != null && !data.exists() || auth.token.email === 'ukiyo@rekindle.ink'",
                    ".validate": "newData.hasChildren(['user', 'text', 'timestamp']) && !newData.child('user').val().matches(/.*[wW][aA][nN][tT][bB][aA][nN].*/) || auth.token.email === 'ukiyo@rekindle.ink'",
                    "reactions": {
                        "$uid": {
                            ".write": "auth.uid === $uid",
                            ".validate": "newData.hasChildren(['reaction', 'username'])"
                        }
                    }
                }
            }
        },
        "topics": {
            ".read": "auth != null",
            ".indexOn": [
                "lastActive",
                "timestamp"
            ],
            "$topicId": {
                ".write": "auth != null && (!data.exists() || data.child('authorId').val() === auth.uid || auth.token.email === 'ukiyo@rekindle.ink')",
                ".validate": "newData.hasChildren(['title', 'authorId', 'timestamp'])",
                "title": {
                    ".validate": "!data.exists() || newData.val() === data.val() || auth.token.email === 'ukiyo@rekindle.ink'"
                },
                "commentCount": {
                    ".write": "auth != null"
                },
                "lastActive": {
                    ".write": "auth != null"
                }
            }
        },
        "topic_comments": {
            ".indexOn": [
                "timestamp"
            ],
            "$topicId": {
                ".read": "auth != null",
                "$commentId": {
                    ".write": "auth != null && (!data.exists() || data.child('authorId').val() === auth.uid || auth.token.email === 'ukiyo@rekindle.ink')",
                    ".validate": "newData.hasChildren(['body', 'authorId', 'timestamp'])"
                }
            }
        },
        "users_public": {
            ".read": "auth != null",
            "$userId": {
                ".write": "auth != null && (auth.uid === $userId || auth.token.email === 'ukiyo@rekindle.ink')"
            }
        },
        "users_private": {
            "$userId": {
                ".read": "auth != null && auth.uid === $userId",
                ".write": "auth != null && auth.uid === $userId"
            }
        },
        "neighbourhood_posts": {
            ".read": "auth != null",
            ".indexOn": [
                "timestamp"
            ],
            "$postId": {
                "comments": {
                    ".indexOn": [
                        "timestamp"
                    ],
                    "$commentId": {
                        ".write": "auth != null && (!data.exists() || data.child('uid').val() === auth.uid || auth.token.email === 'ukiyo@rekindle.ink')",
                        ".validate": "newData.hasChildren(['uid', 'text', 'timestamp'])"
                    }
                },
                ".write": "auth != null && ((!data.exists() && newData.child('uid').val() === auth.uid) || (data.exists() && data.child('uid').val() === auth.uid) || auth.token.email === 'ukiyo@rekindle.ink')",
                ".validate": "auth.token.email === 'ukiyo@rekindle.ink' || !newData.exists() || (newData.hasChildren(['uid', 'text', 'timestamp']) && (newData.child('uid').val() === auth.uid || (data.exists() && data.child('uid').val() === newData.child('uid').val() && data.child('text').val() === newData.child('text').val() && data.child('timestamp').val() === newData.child('timestamp').val())))"
            }
        }
    }
}